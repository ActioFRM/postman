{
  "info": {
    "_postman_id": "87cf42ea-c617-4922-bbe9-161c22c8a27f",
    "name": "Rule-016Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Test Scenario 1",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Less than 5 successful transactions - false\r",
              "\r",
              "const jsonData = pm.response.json();\r",
              "const req = JSON.parse(request.data);\r",
              "\r",
              "const transactions = [\"96ae98292ec04bf29b5d40ba99864c38\"]\r",
              "const graphTransactions = [\r",
              "    \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\"\r",
              "]\r",
              "\r",
              "pm.test(\"Status code is 200\", function () {\r",
              "    pm.response.to.have.status(200);\r",
              "});\r",
              "\r",
              "pm.test(\"should have rule result of false\", function () {\r",
              "    pm.expect(jsonData.ruleResult.result).to.be.eql(false);\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from DB\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(transactions)}\r",
              "                \"TxTp.FIToFICstmrCdt.GrpHdr\": {\r",
              "            \"MsgId\r",
              "                        REMOVE { _key: transaction } IN transactionHistory\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from transactionGraph\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(graphTransactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionRelationship\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Less than 5 successful transactions in threshold - false\r",
              "\r",
              "const now = new Date().getTime();\r",
              "\r",
              "pm.globals.set(\"now\", new Date().toISOString());\r",
              "\r",
              "const ruleConfig = [\r",
              "    {\r",
              "    \"id\": \"016@1.0.0\",\r",
              "    \"cfg\": \"1.0.0\",\r",
              "    \"config\": {\r",
              "       \"timeframes\": [\r",
              "            {\r",
              "                \"threshold\": 86400000\r",
              "            }\r",
              "        ],\r",
              "        \"bands\": [\r",
              "            {\r",
              "                \"subRuleRef\": \".01\",\r",
              "                \"lowerLimit\": 5,\r",
              "                \"outcome\": true,\r",
              "                \"reason\": \"Transaction convergence detected on creditor account\"\r",
              "            },\r",
              "            {\r",
              "                \"subRuleRef\": \".00\",\r",
              "                \"upperLimit\": 5,\r",
              "                \"outcome\": false,\r",
              "                \"reason\": \"No Transaction convergence detected on creditor account\"\r",
              "            }\r",
              "        ]\r",
              "    }\r",
              "  }\r",
              "]\r",
              "\r",
              "const pacs008Transactions = [{\r",
              "    \"TxTp\": \"pacs.008.001.10\",\r",
              "    \"FIToFICstmrCdt\": {\r",
              "        \"GrpHdr\": {\r",
              "            \"MsgId\": \"96ae98292ec04bf29b5d40ba99864c38\",\r",
              "            \"CreDtTm\": new Date(now - 10000).toISOString(),\r",
              "            \"NbOfTxs\": 1,\r",
              "            \"SttlmInf\": {\r",
              "                \"SttlmMtd\": \"CLRG\"\r",
              "            }\r",
              "        },\r",
              "        \"CdtTrfTxInf\": {\r",
              "            \"PmtId\": {\r",
              "                \"InstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2\",\r",
              "                \"EndToEndId\": \"2c516801007642dfb892944dde1cf845897\"\r",
              "            },\r",
              "            \"IntrBkSttlmAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"InstdAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"ChrgBr\": \"DEBT\",\r",
              "            \"ChrgsInf\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 307.14,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                },\r",
              "                \"Agt\": {\r",
              "                    \"FinInstnId\": {\r",
              "                        \"ClrSysMmbId\": {\r",
              "                            \"MmbId\": \"dfsp001\"\r",
              "                        }\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"InitgPty\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"Dbtr\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"DbtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"April Grant\"\r",
              "            },\r",
              "            \"DbtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp001\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp002\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"Cdtr\": {\r",
              "                \"Nm\": \"Felicia Easton Quill\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1935-05-08\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27707650428\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-707650428\"\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"Felicia Quill\"\r",
              "            },\r",
              "            \"Purp\": {\r",
              "                \"Cd\": \"MP2P\"\r",
              "            }\r",
              "        },\r",
              "        \"RgltryRptg\": {\r",
              "            \"Dtls\": {\r",
              "                \"Tp\": \"BALANCE OF PAYMENTS\",\r",
              "                \"Cd\": \"100\"\r",
              "            }\r",
              "        },\r",
              "        \"RmtInf\": {\r",
              "            \"Ustrd\": \"Payment of USD 30713.75 from April to Felicia\"\r",
              "        },\r",
              "        \"SplmtryData\": {\r",
              "            \"Envlp\": {\r",
              "                \"Doc\": {\r",
              "                    \"Xprtn\": \"2021-11-30T10:38:56.000Z\"\r",
              "                }\r",
              "            }\r",
              "        }\r",
              "    }\r",
              "}]\r",
              "\r",
              "const transactionGraph = [{\r",
              "    _key: \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 120000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 3600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 57600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 90000000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "}]\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(pacs008Transactions)}\r",
              "                    INSERT {_key: transaction.FIToFICstmrCdt.GrpHdr.MsgId, TxTp: transaction.TxTp, FIToFICstmrCdt: transaction.FIToFICstmrCdt} INTO transactionHistory\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(transactionGraph)}\r",
              "                    INSERT transaction INTO transactionRelationship\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/Configuration/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR config IN ${JSON.stringify(ruleConfig)}\r",
              "                    INSERT {_key: \"016\", id: config.id, cfg: config.cfg, config: config.config} INTO configuration\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"transaction\": {\r\n        \"TxTp\": \"pacs.002.001.12\",\r\n        \"FIToFIPmtSts\": {\r\n            \"GrpHdr\": {\r\n                \"MsgId\": \"30bea71c5a054978ad0da7f94b2a40e9789\",\r\n                \"CreDtTm\": \"{{now}}\"\r\n            },\r\n            \"TxInfAndSts\": {\r\n                \"OrgnlInstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2255\",\r\n                \"OrgnlEndToEndId\": \"2c516801007642dfb892944dde1cf845897\",\r\n                \"TxSts\": \"ACCC\",\r\n                \"ChrgsInf\": [\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 307.14,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 153.57,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 30.71,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp002\"\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ],\r\n                \"AccptncDtTm\": \"2021-12-03T15:24:26.000Z\",\r\n                \"InstgAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp001\"\r\n                        }\r\n                    }\r\n                },\r\n                \"InstdAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp002\"\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"networkMap\": {\r\n        \"messages\": [\r\n            {\r\n                \"id\": \"004@1.0.0\",\r\n                \"host\": \"http://gateway.openfaas:8080/function/off-transaction-aggregation-decisioning-processor-rel-1-1-0\",\r\n                \"cfg\": \"1.0.0\",\r\n                \"txTp\": \"pacs.002.001.12\",\r\n                \"channels\": [\r\n                    {\r\n                        \"id\": \"001@1.0.0\",\r\n                        \"host\": \"http://gateway.openfaas:8080/function/off-channel-aggregation-decisioning-processor-rel-1-1-0\",\r\n                        \"cfg\": \"1.0.0\",\r\n                        \"typologies\": [\r\n                            {\r\n                                \"id\": \"028@1.0.0\",\r\n                                \"host\": \"http://gateway.openfaas:8080/function/off-typology-processor-rel-1-0-0\",\r\n                                \"cfg\": \"1.0.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"016@1.0.0\",\r\n                                        \"host\": \"http://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0\",\r\n                                        \"cfg\": \"1.0.0\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0/execute",
          "protocol": "https",
          "host": ["gateway", "openfaas"],
          "port": "8080",
          "path": ["function", "off-rule-016-rel-1-0-0", "execute"]
        }
      },
      "response": []
    },
    {
      "name": "Test Scenario 2",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// 5 or more successful transactions - true\r",
              "\r",
              "const now = new Date().getTime();\r",
              "\r",
              "pm.globals.set(\"now\", new Date().toISOString());;\r",
              "\r",
              "const ruleConfig = [\r",
              "    {\r",
              "    \"id\": \"016@1.0.0\",\r",
              "    \"cfg\": \"1.0.0\",\r",
              "    \"config\": {\r",
              "       \"timeframes\": [\r",
              "            {\r",
              "                \"threshold\": 86400000\r",
              "            }\r",
              "        ],\r",
              "        \"bands\": [\r",
              "            {\r",
              "                \"subRuleRef\": \".01\",\r",
              "                \"lowerLimit\": 5,\r",
              "                \"outcome\": true,\r",
              "                \"reason\": \"Transaction convergence detected on creditor account\"\r",
              "            },\r",
              "            {\r",
              "                \"subRuleRef\": \".00\",\r",
              "                \"upperLimit\": 5,\r",
              "                \"outcome\": false,\r",
              "                \"reason\": \"No Transaction convergence detected on creditor account\"\r",
              "            }\r",
              "        ]\r",
              "    }\r",
              "  }\r",
              "]\r",
              "\r",
              "const pacs008Transactions = [{\r",
              "    \"TxTp\": \"pacs.008.001.10\",\r",
              "    \"FIToFICstmrCdt\": {\r",
              "        \"GrpHdr\": {\r",
              "            \"MsgId\": \"96ae98292ec04bf29b5d40ba99864c38\",\r",
              "            \"CreDtTm\": new Date(now - 10000).toISOString(),\r",
              "            \"NbOfTxs\": 1,\r",
              "            \"SttlmInf\": {\r",
              "                \"SttlmMtd\": \"CLRG\"\r",
              "            }\r",
              "        },\r",
              "        \"CdtTrfTxInf\": {\r",
              "            \"PmtId\": {\r",
              "                \"InstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2\",\r",
              "                \"EndToEndId\": \"2c516801007642dfb892944dde1cf845897\"\r",
              "            },\r",
              "            \"IntrBkSttlmAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"InstdAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"ChrgBr\": \"DEBT\",\r",
              "            \"ChrgsInf\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 307.14,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                },\r",
              "                \"Agt\": {\r",
              "                    \"FinInstnId\": {\r",
              "                        \"ClrSysMmbId\": {\r",
              "                            \"MmbId\": \"dfsp001\"\r",
              "                        }\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"InitgPty\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"Dbtr\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"DbtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"April Grant\"\r",
              "            },\r",
              "            \"DbtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp001\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp002\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"Cdtr\": {\r",
              "                \"Nm\": \"Felicia Easton Quill\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1935-05-08\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27707650428\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-707650428\"\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"Felicia Quill\"\r",
              "            },\r",
              "            \"Purp\": {\r",
              "                \"Cd\": \"MP2P\"\r",
              "            }\r",
              "        },\r",
              "        \"RgltryRptg\": {\r",
              "            \"Dtls\": {\r",
              "                \"Tp\": \"BALANCE OF PAYMENTS\",\r",
              "                \"Cd\": \"100\"\r",
              "            }\r",
              "        },\r",
              "        \"RmtInf\": {\r",
              "            \"Ustrd\": \"Payment of USD 30713.75 from April to Felicia\"\r",
              "        },\r",
              "        \"SplmtryData\": {\r",
              "            \"Envlp\": {\r",
              "                \"Doc\": {\r",
              "                    \"Xprtn\": \"2021-11-30T10:38:56.000Z\"\r",
              "                }\r",
              "            }\r",
              "        }\r",
              "    }\r",
              "}]\r",
              "\r",
              "const transactionGraph = [{\r",
              "    _key: \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 120000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 3600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 57600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 90000000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"f939126a22a10686d17104dad6d4dc69fa92cb483b9063a9d2c54acdbc551e9f\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 64800000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "}]\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(pacs008Transactions)}\r",
              "                    INSERT {_key: transaction.FIToFICstmrCdt.GrpHdr.MsgId, TxTp: transaction.TxTp, FIToFICstmrCdt: transaction.FIToFICstmrCdt} INTO transactionHistory\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(transactionGraph)}\r",
              "                    INSERT transaction INTO transactionRelationship\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/Configuration/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR config IN ${JSON.stringify(ruleConfig)}\r",
              "                    INSERT {_key: \"016\", id: config.id, cfg: config.cfg, config: config.config} INTO configuration\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// 5 or more successful transactions - true\r",
              "\r",
              "const jsonData = pm.response.json();\r",
              "const req = JSON.parse(request.data);\r",
              "\r",
              "const transactions = [\"96ae98292ec04bf29b5d40ba99864c38\"]\r",
              "const graphTransactions = [\r",
              "    \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    \"f939126a22a10686d17104dad6d4dc69fa92cb483b9063a9d2c54acdbc551e9f\"\r",
              "]\r",
              "\r",
              "pm.test(\"Status code is 200\", function () {\r",
              "    pm.response.to.have.status(200);\r",
              "});\r",
              "\r",
              "pm.test(\"should have rule result of true\", function () {\r",
              "    pm.expect(jsonData.ruleResult.result).to.be.eql(true);\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from DB\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(transactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionHistory\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from transactionGraph\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(graphTransactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionRelationship\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"transaction\": {\r\n        \"TxTp\": \"pacs.002.001.12\",\r\n        \"FIToFIPmtSts\": {\r\n            \"GrpHdr\": {\r\n                \"MsgId\": \"30bea71c5a054978ad0da7f94b2a40e9789\",\r\n                \"CreDtTm\": \"{{now}}\"\r\n            },\r\n            \"TxInfAndSts\": {\r\n                \"OrgnlInstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2255\",\r\n                \"OrgnlEndToEndId\": \"2c516801007642dfb892944dde1cf845897\",\r\n                \"TxSts\": \"ACCC\",\r\n                \"ChrgsInf\": [\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 307.14,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 153.57,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 30.71,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp002\"\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ],\r\n                \"AccptncDtTm\": \"2021-12-03T15:24:26.000Z\",\r\n                \"InstgAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp001\"\r\n                        }\r\n                    }\r\n                },\r\n                \"InstdAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp002\"\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"networkMap\": {\r\n        \"messages\": [\r\n            {\r\n                \"id\": \"004@1.0.0\",\r\n                \"host\": \"https://gateway.openfaas:8080/function/off-transaction-aggregation-decisioning-processor-rel-1-1-0\",\r\n                \"cfg\": \"1.0.0\",\r\n                \"txTp\": \"pacs.002.001.12\",\r\n                \"channels\": [\r\n                    {\r\n                        \"id\": \"001@1.0.0\",\r\n                        \"host\": \"https://gateway.openfaas:8080/function/off-channel-aggregation-decisioning-processor-rel-1-1-0\",\r\n                        \"cfg\": \"1.0.0\",\r\n                        \"typologies\": [\r\n                            {\r\n                                \"id\": \"028@1.0.0\",\r\n                                \"host\": \"https://gateway.openfaas:8080/function/off-typology-processor-rel-1-0-0\",\r\n                                \"cfg\": \"1.0.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"016@1.0.0\",\r\n                                        \"host\": \"https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0\",\r\n                                        \"cfg\": \"1.0.0\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0/execute",
          "protocol": "https",
          "host": ["gateway", "openfaas"],
          "port": "8080",
          "path": ["function", "off-rule-016-rel-1-0-0", "execute"]
        }
      },
      "response": []
    },
    {
      "name": "Test Scenario 3",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// 4 successful transactions in threshold, 1 out of threshold and 1 unsuccessful - false\r",
              "\r",
              "const now = new Date().getTime();\r",
              "\r",
              "pm.globals.set(\"now\", new Date().toISOString());\r",
              "\r",
              "\r",
              "const ruleConfig = [\r",
              "    {\r",
              "    \"id\": \"016@1.0.0\",\r",
              "    \"cfg\": \"1.0.0\",\r",
              "    \"config\": {\r",
              "       \"timeframes\": [\r",
              "            {\r",
              "                \"threshold\": 86400000\r",
              "            }\r",
              "        ],\r",
              "        \"bands\": [\r",
              "            {\r",
              "                \"subRuleRef\": \".01\",\r",
              "                \"lowerLimit\": 5,\r",
              "                \"outcome\": true,\r",
              "                \"reason\": \"Transaction convergence detected on creditor account\"\r",
              "            },\r",
              "            {\r",
              "                \"subRuleRef\": \".00\",\r",
              "                \"upperLimit\": 5,\r",
              "                \"outcome\": false,\r",
              "                \"reason\": \"No Transaction convergence detected on creditor account\"\r",
              "            }\r",
              "        ]\r",
              "    }\r",
              "  }\r",
              "]\r",
              "\r",
              "const pacs008Transactions = [{\r",
              "    \"TxTp\": \"pacs.008.001.10\",\r",
              "    \"FIToFICstmrCdt\": {\r",
              "        \"GrpHdr\": {\r",
              "            \"MsgId\": \"96ae98292ec04bf29b5d40ba99864c38\",\r",
              "            \"CreDtTm\": new Date(now - 10000).toISOString(),\r",
              "            \"NbOfTxs\": 1,\r",
              "            \"SttlmInf\": {\r",
              "                \"SttlmMtd\": \"CLRG\"\r",
              "            }\r",
              "        },\r",
              "        \"CdtTrfTxInf\": {\r",
              "            \"PmtId\": {\r",
              "                \"InstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2\",\r",
              "                \"EndToEndId\": \"2c516801007642dfb892944dde1cf845897\"\r",
              "            },\r",
              "            \"IntrBkSttlmAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"InstdAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"ChrgBr\": \"DEBT\",\r",
              "            \"ChrgsInf\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 307.14,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                },\r",
              "                \"Agt\": {\r",
              "                    \"FinInstnId\": {\r",
              "                        \"ClrSysMmbId\": {\r",
              "                            \"MmbId\": \"dfsp001\"\r",
              "                        }\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"InitgPty\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"Dbtr\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"DbtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"April Grant\"\r",
              "            },\r",
              "            \"DbtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp001\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp002\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"Cdtr\": {\r",
              "                \"Nm\": \"Felicia Easton Quill\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1935-05-08\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27707650428\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-707650428\"\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"Felicia Quill\"\r",
              "            },\r",
              "            \"Purp\": {\r",
              "                \"Cd\": \"MP2P\"\r",
              "            }\r",
              "        },\r",
              "        \"RgltryRptg\": {\r",
              "            \"Dtls\": {\r",
              "                \"Tp\": \"BALANCE OF PAYMENTS\",\r",
              "                \"Cd\": \"100\"\r",
              "            }\r",
              "        },\r",
              "        \"RmtInf\": {\r",
              "            \"Ustrd\": \"Payment of USD 30713.75 from April to Felicia\"\r",
              "        },\r",
              "        \"SplmtryData\": {\r",
              "            \"Envlp\": {\r",
              "                \"Doc\": {\r",
              "                    \"Xprtn\": \"2021-11-30T10:38:56.000Z\"\r",
              "                }\r",
              "            }\r",
              "        }\r",
              "    }\r",
              "}]\r",
              "\r",
              "\r",
              "const transactionGraph = [{\r",
              "    _key: \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 120000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 3600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 57600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 90000000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"f939126a22a10686d17104dad6d4dc69fa92cb483b9063a9d2c54acdbc551e9f\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"RJCT\",\r",
              "    CreDtTm: new Date(now - 64800000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "}]\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(pacs008Transactions)}\r",
              "                    INSERT {_key: transaction.FIToFICstmrCdt.GrpHdr.MsgId, TxTp: transaction.TxTp, FIToFICstmrCdt: transaction.FIToFICstmrCdt} INTO transactionHistory\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(transactionGraph)}\r",
              "                    INSERT transaction INTO transactionRelationship\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/Configuration/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR config IN ${JSON.stringify(ruleConfig)}\r",
              "                    INSERT {_key: \"016\", id: config.id, cfg: config.cfg, config: config.config} INTO configuration\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// 4 successful transactions in threshold, 1 out of threshold and 1 unsuccessful - false\r",
              "\r",
              "const jsonData = pm.response.json();\r",
              "const req = JSON.parse(request.data);\r",
              "\r",
              "const transactions = [\"96ae98292ec04bf29b5d40ba99864c38\"]\r",
              "const graphTransactions = [\r",
              "    \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    \"f939126a22a10686d17104dad6d4dc69fa92cb483b9063a9d2c54acdbc551e9f\"\r",
              "]\r",
              "\r",
              "pm.test(\"Status code is 200\", function () {\r",
              "    pm.response.to.have.status(200);\r",
              "});\r",
              "\r",
              "pm.test(\"should have rule result of false\", function () {\r",
              "    pm.expect(jsonData.ruleResult.result).to.be.eql(false);\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from DB\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(transactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionHistory\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from transactionGraph\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(graphTransactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionRelationship\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"transaction\": {\r\n        \"TxTp\": \"pacs.002.001.12\",\r\n        \"FIToFIPmtSts\": {\r\n            \"GrpHdr\": {\r\n                \"MsgId\": \"30bea71c5a054978ad0da7f94b2a40e9789\",\r\n                \"CreDtTm\": \"{{now}}\"\r\n            },\r\n            \"TxInfAndSts\": {\r\n                \"OrgnlInstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2255\",\r\n                \"OrgnlEndToEndId\": \"2c516801007642dfb892944dde1cf845897\",\r\n                \"TxSts\": \"ACCC\",\r\n                \"ChrgsInf\": [\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 307.14,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 153.57,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 30.71,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp002\"\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ],\r\n                \"AccptncDtTm\": \"2021-12-03T15:24:26.000Z\",\r\n                \"InstgAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp001\"\r\n                        }\r\n                    }\r\n                },\r\n                \"InstdAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp002\"\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"networkMap\": {\r\n        \"messages\": [\r\n            {\r\n                \"id\": \"004@1.0.0\",\r\n                \"host\": \"https://gateway.openfaas:8080/function/off-transaction-aggregation-decisioning-processor-rel-1-1-0\",\r\n                \"cfg\": \"1.0.0\",\r\n                \"txTp\": \"pacs.002.001.12\",\r\n                \"channels\": [\r\n                    {\r\n                        \"id\": \"001@1.0.0\",\r\n                        \"host\": \"https://gateway.openfaas:8080/function/off-channel-aggregation-decisioning-processor-rel-1-1-0\",\r\n                        \"cfg\": \"1.0.0\",\r\n                        \"typologies\": [\r\n                            {\r\n                                \"id\": \"028@1.0.0\",\r\n                                \"host\": \"https://gateway.openfaas:8080/function/off-typology-processor-rel-1-0-0\",\r\n                                \"cfg\": \"1.0.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"016@1.0.0\",\r\n                                        \"host\": \"https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0\",\r\n                                        \"cfg\": \"1.0.0\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0/execute",
          "protocol": "https",
          "host": ["gateway", "openfaas"],
          "port": "8080",
          "path": ["function", "off-rule-016-rel-1-0-0", "execute"]
        }
      },
      "response": []
    },
    {
      "name": "Test Scenario 4",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// 5 or more successful transactions with increased threshold - true\r",
              "\r",
              "const now = new Date().getTime();\r",
              "\r",
              "pm.globals.set(\"now\", new Date().toISOString());\r",
              "\r",
              "const ruleConfig = [\r",
              "    {\r",
              "    \"id\": \"016@1.0.0\",\r",
              "    \"cfg\": \"1.0.0\",\r",
              "    \"config\": {\r",
              "       \"timeframes\": [\r",
              "            {\r",
              "                \"threshold\": 172800000\r",
              "            }\r",
              "        ],\r",
              "        \"bands\": [\r",
              "            {\r",
              "                \"subRuleRef\": \".01\",\r",
              "                \"lowerLimit\": 5,\r",
              "                \"outcome\": true,\r",
              "                \"reason\": \"Transaction convergence detected on creditor account\"\r",
              "            },\r",
              "            {\r",
              "                \"subRuleRef\": \".00\",\r",
              "                \"upperLimit\": 5,\r",
              "                \"outcome\": false,\r",
              "                \"reason\": \"No Transaction convergence detected on creditor account\"\r",
              "            }\r",
              "        ]\r",
              "    }\r",
              "  }\r",
              "]\r",
              "\r",
              "const pacs008Transactions = [{\r",
              "    \"TxTp\": \"pacs.008.001.10\",\r",
              "    \"FIToFICstmrCdt\": {\r",
              "        \"GrpHdr\": {\r",
              "            \"MsgId\": \"96ae98292ec04bf29b5d40ba99864c38\",\r",
              "            \"CreDtTm\": new Date(now - 10000).toISOString(),\r",
              "            \"NbOfTxs\": 1,\r",
              "            \"SttlmInf\": {\r",
              "                \"SttlmMtd\": \"CLRG\"\r",
              "            }\r",
              "        },\r",
              "        \"CdtTrfTxInf\": {\r",
              "            \"PmtId\": {\r",
              "                \"InstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2\",\r",
              "                \"EndToEndId\": \"2c516801007642dfb892944dde1cf845897\"\r",
              "            },\r",
              "            \"IntrBkSttlmAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"InstdAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"ChrgBr\": \"DEBT\",\r",
              "            \"ChrgsInf\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 307.14,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                },\r",
              "                \"Agt\": {\r",
              "                    \"FinInstnId\": {\r",
              "                        \"ClrSysMmbId\": {\r",
              "                            \"MmbId\": \"dfsp001\"\r",
              "                        }\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"InitgPty\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"Dbtr\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"DbtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"April Grant\"\r",
              "            },\r",
              "            \"DbtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp001\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp002\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"Cdtr\": {\r",
              "                \"Nm\": \"Felicia Easton Quill\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1935-05-08\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27707650428\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-707650428\"\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"Felicia Quill\"\r",
              "            },\r",
              "            \"Purp\": {\r",
              "                \"Cd\": \"MP2P\"\r",
              "            }\r",
              "        },\r",
              "        \"RgltryRptg\": {\r",
              "            \"Dtls\": {\r",
              "                \"Tp\": \"BALANCE OF PAYMENTS\",\r",
              "                \"Cd\": \"100\"\r",
              "            }\r",
              "        },\r",
              "        \"RmtInf\": {\r",
              "            \"Ustrd\": \"Payment of USD 30713.75 from April to Felicia\"\r",
              "        },\r",
              "        \"SplmtryData\": {\r",
              "            \"Envlp\": {\r",
              "                \"Doc\": {\r",
              "                    \"Xprtn\": \"2021-11-30T10:38:56.000Z\"\r",
              "                }\r",
              "            }\r",
              "        }\r",
              "    }\r",
              "}]\r",
              "\r",
              "\r",
              "const transactionGraph = [{\r",
              "    _key: \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 120000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 3600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 57600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 90000000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "}]\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(pacs008Transactions)}\r",
              "                    INSERT {_key: transaction.FIToFICstmrCdt.GrpHdr.MsgId, TxTp: transaction.TxTp, FIToFICstmrCdt: transaction.FIToFICstmrCdt} INTO transactionHistory\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(transactionGraph)}\r",
              "                    INSERT transaction INTO transactionRelationship\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/Configuration/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR config IN ${JSON.stringify(ruleConfig)}\r",
              "                    INSERT {_key: \"016\", id: config.id, cfg: config.cfg, config: config.config} INTO configuration\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// 5 or more successful transactions with increased threshold - true\r",
              "\r",
              "const jsonData = pm.response.json();\r",
              "const req = JSON.parse(request.data);\r",
              "\r",
              "const transactions = [\"96ae98292ec04bf29b5d40ba99864c38\"]\r",
              "const graphTransactions = [\r",
              "    \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\"\r",
              "    ]\r",
              "\r",
              "pm.test(\"Status code is 200\", function () {\r",
              "    pm.response.to.have.status(200);\r",
              "});\r",
              "\r",
              "pm.test(\"should have rule result of true\", function () {\r",
              "    pm.expect(jsonData.ruleResult.result).to.be.eql(true);\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from DB\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(transactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionHistory\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from transactionGraph\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(graphTransactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionRelationship\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"transaction\": {\r\n        \"TxTp\": \"pacs.002.001.12\",\r\n        \"FIToFIPmtSts\": {\r\n            \"GrpHdr\": {\r\n                \"MsgId\": \"30bea71c5a054978ad0da7f94b2a40e9789\",\r\n                \"CreDtTm\": \"{{now}}\"\r\n            },\r\n            \"TxInfAndSts\": {\r\n                \"OrgnlInstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2255\",\r\n                \"OrgnlEndToEndId\": \"2c516801007642dfb892944dde1cf845897\",\r\n                \"TxSts\": \"ACCC\",\r\n                \"ChrgsInf\": [\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 307.14,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 153.57,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 30.71,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp002\"\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ],\r\n                \"AccptncDtTm\": \"2021-12-03T15:24:26.000Z\",\r\n                \"InstgAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp001\"\r\n                        }\r\n                    }\r\n                },\r\n                \"InstdAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp002\"\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"networkMap\": {\r\n        \"messages\": [\r\n            {\r\n                \"id\": \"004@1.0.0\",\r\n                \"host\": \"https://gateway.openfaas:8080/function/off-transaction-aggregation-decisioning-processor-rel-1-1-0\",\r\n                \"cfg\": \"1.0.0\",\r\n                \"txTp\": \"pacs.002.001.12\",\r\n                \"channels\": [\r\n                    {\r\n                        \"id\": \"001@1.0.0\",\r\n                        \"host\": \"https://gateway.openfaas:8080/function/off-channel-aggregation-decisioning-processor-rel-1-1-0\",\r\n                        \"cfg\": \"1.0.0\",\r\n                        \"typologies\": [\r\n                            {\r\n                                \"id\": \"028@1.0.0\",\r\n                                \"host\": \"https://gateway.openfaas:8080/function/off-typology-processor-rel-1-0-0\",\r\n                                \"cfg\": \"1.0.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"016@1.0.0\",\r\n                                        \"host\": \"https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0\",\r\n                                        \"cfg\": \"1.0.0\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0/execute",
          "protocol": "https",
          "host": ["gateway", "openfaas"],
          "port": "8080",
          "path": ["function", "off-rule-016-rel-1-0-0", "execute"]
        }
      },
      "response": []
    },
    {
      "name": "Test Scenario 5",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// 5 or more successful transactions with decreased threshold - false\r",
              "\r",
              "const now = new Date().getTime();\r",
              "\r",
              "pm.globals.set(\"now\", new Date().toISOString());\r",
              "\r",
              "const ruleConfig = [\r",
              "    {\r",
              "    \"id\": \"016@1.0.0\",\r",
              "    \"cfg\": \"1.0.0\",\r",
              "    \"config\": {\r",
              "       \"timeframes\": [\r",
              "            {\r",
              "                \"threshold\": 6\r",
              "            }\r",
              "        ],\r",
              "        \"bands\": [\r",
              "            {\r",
              "                \"subRuleRef\": \".01\",\r",
              "                \"lowerLimit\": 5,\r",
              "                \"outcome\": true,\r",
              "                \"reason\": \"Transaction convergence detected on creditor account\"\r",
              "            },\r",
              "            {\r",
              "                \"subRuleRef\": \".00\",\r",
              "                \"upperLimit\": 5,\r",
              "                \"outcome\": false,\r",
              "                \"reason\": \"No Transaction convergence detected on creditor account\"\r",
              "            }\r",
              "        ]\r",
              "    }\r",
              "  }\r",
              "]\r",
              "\r",
              "const pacs008Transactions = [{\r",
              "    \"TxTp\": \"pacs.008.001.10\",\r",
              "    \"FIToFICstmrCdt\": {\r",
              "        \"GrpHdr\": {\r",
              "            \"MsgId\": \"96ae98292ec04bf29b5d40ba99864c38\",\r",
              "            \"CreDtTm\": new Date(now - 10000).toISOString(),\r",
              "            \"NbOfTxs\": 1,\r",
              "            \"SttlmInf\": {\r",
              "                \"SttlmMtd\": \"CLRG\"\r",
              "            }\r",
              "        },\r",
              "        \"CdtTrfTxInf\": {\r",
              "            \"PmtId\": {\r",
              "                \"InstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2\",\r",
              "                \"EndToEndId\": \"2c516801007642dfb892944dde1cf845897\"\r",
              "            },\r",
              "            \"IntrBkSttlmAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"InstdAmt\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 31020.89,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                }\r",
              "            },\r",
              "            \"ChrgBr\": \"DEBT\",\r",
              "            \"ChrgsInf\": {\r",
              "                \"Amt\": {\r",
              "                    \"Amt\": 307.14,\r",
              "                    \"Ccy\": \"USD\"\r",
              "                },\r",
              "                \"Agt\": {\r",
              "                    \"FinInstnId\": {\r",
              "                        \"ClrSysMmbId\": {\r",
              "                            \"MmbId\": \"dfsp001\"\r",
              "                        }\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"InitgPty\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"Dbtr\": {\r",
              "                \"Nm\": \"April Blake Grant\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1968-02-01\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27730975224\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-730975224\"\r",
              "                }\r",
              "            },\r",
              "            \"DbtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"April Grant\"\r",
              "            },\r",
              "            \"DbtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp001\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAgt\": {\r",
              "                \"FinInstnId\": {\r",
              "                    \"ClrSysMmbId\": {\r",
              "                        \"MmbId\": \"dfsp002\"\r",
              "                    }\r",
              "                }\r",
              "            },\r",
              "            \"Cdtr\": {\r",
              "                \"Nm\": \"Felicia Easton Quill\",\r",
              "                \"Id\": {\r",
              "                    \"PrvtId\": {\r",
              "                        \"DtAndPlcOfBirth\": {\r",
              "                            \"BirthDt\": \"1935-05-08\",\r",
              "                            \"CityOfBirth\": \"Unknown\",\r",
              "                            \"CtryOfBirth\": \"ZZ\"\r",
              "                        },\r",
              "                        \"Othr\": {\r",
              "                            \"Id\": \"+27707650428\",\r",
              "                            \"SchmeNm\": {\r",
              "                                \"Prtry\": \"MSISDN\"\r",
              "                            }\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"CtctDtls\": {\r",
              "                    \"MobNb\": \"+27-707650428\"\r",
              "                }\r",
              "            },\r",
              "            \"CdtrAcct\": {\r",
              "                \"Id\": {\r",
              "                    \"Othr\": {\r",
              "                        \"Id\": \"efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "                        \"SchmeNm\": {\r",
              "                            \"Prtry\": \"PSEUDO\"\r",
              "                        }\r",
              "                    }\r",
              "                },\r",
              "                \"Nm\": \"Felicia Quill\"\r",
              "            },\r",
              "            \"Purp\": {\r",
              "                \"Cd\": \"MP2P\"\r",
              "            }\r",
              "        },\r",
              "        \"RgltryRptg\": {\r",
              "            \"Dtls\": {\r",
              "                \"Tp\": \"BALANCE OF PAYMENTS\",\r",
              "                \"Cd\": \"100\"\r",
              "            }\r",
              "        },\r",
              "        \"RmtInf\": {\r",
              "            \"Ustrd\": \"Payment of USD 30713.75 from April to Felicia\"\r",
              "        },\r",
              "        \"SplmtryData\": {\r",
              "            \"Envlp\": {\r",
              "                \"Doc\": {\r",
              "                    \"Xprtn\": \"2021-11-30T10:38:56.000Z\"\r",
              "                }\r",
              "            }\r",
              "        }\r",
              "    }\r",
              "}]\r",
              "\r",
              "\r",
              "const transactionGraph = [{\r",
              "    _key: \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    _from: \"accounts/efdafefdee55c7a1e5eba4ccc0f01639dc37a020241b20495378f5a1343985b4\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    _from: \"accounts/e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 120000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    _from: \"accounts/e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 3600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    _from: \"accounts/e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 57600000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    _from: \"accounts/e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 90000000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "},{\r",
              "    _key: \"f939126a22a10686d17104dad6d4dc69fa92cb483b9063a9d2c54acdbc551e9f\",\r",
              "    _from: \"accounts/e2fa05b6a56ceedb37581703b98590b44194a8c0d2799f4319ebbece5e20ecc1\",\r",
              "    _to: \"accounts/af36cfd29dd05eb483358899055a552af93cd7ae36093832189e63dab1954e90\",\r",
              "    TxTp: \"pacs.002.001.12\",\r",
              "    TxSts: \"ACCC\",\r",
              "    CreDtTm: new Date(now - 64800000).toISOString(),\r",
              "    PmtInfId: \"2f68ae16-467a-4ac4-ba32-eb518646aa1d\",\r",
              "    EndToEndId: \"5cb8a2db-5c32-41bb-ac27-2597125d50fd\"\r",
              "}]\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(pacs008Transactions)}\r",
              "                    INSERT {_key: transaction.FIToFICstmrCdt.GrpHdr.MsgId, TxTp: transaction.TxTp, FIToFICstmrCdt: transaction.FIToFICstmrCdt} INTO transactionHistory\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR transaction IN ${JSON.stringify(transactionGraph)}\r",
              "                    INSERT transaction INTO transactionRelationship\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});\r",
              "\r",
              "pm.sendRequest({\r",
              "    url: 'http://arango.development:8529/_db/Configuration/_api/cursor',\r",
              "    method: 'POST',\r",
              "    header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "    body: {\r",
              "        mode: 'raw',\r",
              "        raw: JSON.stringify({\r",
              "            query: `FOR config IN ${JSON.stringify(ruleConfig)}\r",
              "                    INSERT {_key: \"016\", id: config.id, cfg: config.cfg, config: config.config} INTO configuration\r",
              "                    OPTIONS { overwrite: true }`\r",
              "        })\r",
              "    }\r",
              "});"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// 5 or more successful transactions with decreased threshold - false\r",
              "\r",
              "const jsonData = pm.response.json();\r",
              "const req = JSON.parse(request.data);\r",
              "\r",
              "const transactions = [\"96ae98292ec04bf29b5d40ba99864c38\"]\r",
              "const graphTransactions = [\r",
              "    \"d923682a97089a8416151ad1e58355b8eeee108007f7accd4adc9dc7067767d7\",\r",
              "    \"624501267341c252e385b3bae4b5ca010ace4cdf3faf1b8cb42cc9fa623113a5\",\r",
              "    \"45d854a43923d97bd162805869240a921a595a10f8e6c7e896089333c71cbaf1\",\r",
              "    \"4289b79ef4ebd86c5e958e589fa87b98f56f1ed29f05b5cda1aaa6217275e1fe\",\r",
              "    \"7721f9abaa02f7fd9ad33c5bab58fdb7179f88994691f20a53d0303fee17a0ae\",\r",
              "    \"f939126a22a10686d17104dad6d4dc69fa92cb483b9063a9d2c54acdbc551e9f\"\r",
              "]\r",
              "\r",
              "pm.test(\"Status code is 200\", function () {\r",
              "    pm.response.to.have.status(200);\r",
              "});\r",
              "\r",
              "pm.test(\"should have rule result of false\", function () {\r",
              "    pm.expect(jsonData.ruleResult.result).to.be.eql(false);\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from DB\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/transactionHistory/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(transactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionHistory\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});\r",
              "\r",
              "pm.test(\"Remove Seed Data from transactionGraph\", function () {\r",
              "    pm.sendRequest({\r",
              "        url: 'http://arango.development:8529/_db/pseudonyms/_api/cursor',\r",
              "        method: 'POST',\r",
              "        header: { 'Authorization': `Bearer ${pm.globals.get(\"arangoToken\")}` },\r",
              "        body: {\r",
              "            mode: 'raw',\r",
              "            raw: JSON.stringify({\r",
              "                query: `FOR transaction IN ${JSON.stringify(graphTransactions)}\r",
              "                        REMOVE { _key: transaction } IN transactionRelationship\r",
              "                        OPTIONS { ignoreErrors: true }`\r",
              "            })\r",
              "        }\r",
              "    })\r",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"transaction\": {\r\n        \"TxTp\": \"pacs.002.001.12\",\r\n        \"FIToFIPmtSts\": {\r\n            \"GrpHdr\": {\r\n                \"MsgId\": \"30bea71c5a054978ad0da7f94b2a40e9789\",\r\n                \"CreDtTm\": \"{{now}}\"\r\n            },\r\n            \"TxInfAndSts\": {\r\n                \"OrgnlInstrId\": \"5ab4fc7355de4ef8a75b78b00a681ed2255\",\r\n                \"OrgnlEndToEndId\": \"2c516801007642dfb892944dde1cf845897\",\r\n                \"TxSts\": \"ACCC\",\r\n                \"ChrgsInf\": [\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 307.14,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 153.57,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp001\"\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"Amt\": {\r\n                            \"Amt\": 30.71,\r\n                            \"Ccy\": \"USD\"\r\n                        },\r\n                        \"Agt\": {\r\n                            \"FinInstnId\": {\r\n                                \"ClrSysMmbId\": {\r\n                                    \"MmbId\": \"dfsp002\"\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ],\r\n                \"AccptncDtTm\": \"2021-12-03T15:24:26.000Z\",\r\n                \"InstgAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp001\"\r\n                        }\r\n                    }\r\n                },\r\n                \"InstdAgt\": {\r\n                    \"FinInstnId\": {\r\n                        \"ClrSysMmbId\": {\r\n                            \"MmbId\": \"dfsp002\"\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"networkMap\": {\r\n        \"messages\": [\r\n            {\r\n                \"id\": \"004@1.0.0\",\r\n                \"host\": \"https://gateway.openfaas:8080/function/off-transaction-aggregation-decisioning-processor-rel-1-1-0\",\r\n                \"cfg\": \"1.0.0\",\r\n                \"txTp\": \"pacs.002.001.12\",\r\n                \"channels\": [\r\n                    {\r\n                        \"id\": \"001@1.0.0\",\r\n                        \"host\": \"https://gateway.openfaas:8080/function/off-channel-aggregation-decisioning-processor-rel-1-1-0\",\r\n                        \"cfg\": \"1.0.0\",\r\n                        \"typologies\": [\r\n                            {\r\n                                \"id\": \"028@1.0.0\",\r\n                                \"host\": \"https://gateway.openfaas:8080/function/off-typology-processor-rel-1-0-0\",\r\n                                \"cfg\": \"1.0.0\",\r\n                                \"rules\": [\r\n                                    {\r\n                                        \"id\": \"016@1.0.0\",\r\n                                        \"host\": \"https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0\",\r\n                                        \"cfg\": \"1.0.0\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://gateway.openfaas:8080/function/off-rule-016-rel-1-0-0/execute",
          "protocol": "https",
          "host": ["gateway", "openfaas"],
          "port": "8080",
          "path": ["function", "off-rule-016-rel-1-0-0", "execute"]
        }
      },
      "response": []
    }
  ]
}
